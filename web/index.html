<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <script defer src="/assets/app.js"></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>CRM Varizemed ‚Ä¢ MVP</title>
  <link rel="icon" href="/favicon.ico" />
  <style>
    :root{
      --bg:#0b1120; 
      --panel:#111827; 
      --muted:#9ca3af; 
      --text:#e5e7eb; 
      --acc:#22c55e; 
      --warn:#f59e0b; 
      --danger:#ef4444; 
      --card:#0f172a; 
      --border:#1f2937;
    }
    *{box-sizing:border-box}
    html,body{height:100%;overflow:hidden}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial
    }
    .top{
      display:flex;
      align-items:center;
      gap:12px;
      padding:10px 16px;
      border-bottom:1px solid var(--border);
      background:var(--panel);
      position:sticky;
      top:0;
      z-index:10
    }
    .brand{font-weight:700;letter-spacing:.3px}
    .spacer{flex:1}
    .btn{
      background:#1f2937;
      border:1px solid #2b3644;
      color:#e5e7eb;
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer
    }
    .btn:hover{background:#273244}
    .btn-acc{background:var(--acc);border-color:var(--acc);color:#06210f}
    .btn-acc:hover{filter:brightness(0.95)}
    .btn-warn{background:var(--warn);border-color:var(--warn);color:#111}
    .btn-danger{background:var(--danger);border-color:var(--danger);color:#fff}
    
    .layout{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:12px;
      padding:12px;
      height:calc(100% - 54px);
      overflow:hidden;
    }
    
    /* Tabs container */
    .tabs-container{
      display:flex;
      flex-direction:column;
      gap:12px;
      height:100%;
      overflow:hidden;
    }
    
    .tabs{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:4px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:12px;
      padding:6px;
    }
    
    .tab{
      background:transparent;
      border:none;
      color:var(--muted);
      padding:10px 8px;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:0.5px;
      transition:all 0.2s;
      position:relative;
    }
    
    .tab:hover{
      background:rgba(255,255,255,0.05);
      color:var(--text);
    }
    
    .tab.active{
      background:var(--acc);
      color:#06210f;
    }
    
    .tab.alert{
      animation:pulse 2s infinite;
      background:var(--danger);
      color:#fff;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Search box */
    .search-box{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    
    .search-icon{
      color:var(--muted);
      font-size:18px;
    }
    
    .search-box input{
      flex:1;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid var(--border);
      background:#0b1224;
      color:var(--text);
      font-size:14px;
    }
    
    /* Conversations list */
    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
      max-height:100%;
    }
    
    .card h3{
      margin:0;
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      font-size:14px;
      font-weight:600;
      flex-shrink:0;
    }
    
    .list{
      display:flex;
      flex-direction:column;
      gap:6px;
      overflow-y:auto;
      overflow-x:hidden;
      padding:10px;
      flex:1;
      min-height:0;
    }
    
    /* Scrollbar customizado */
    .list::-webkit-scrollbar{
      width:8px;
    }
    
    .list::-webkit-scrollbar-track{
      background:var(--panel);
    }
    
    .list::-webkit-scrollbar-thumb{
      background:var(--border);
      border-radius:4px;
    }
    
    .list::-webkit-scrollbar-thumb:hover{
      background:var(--muted);
    }
    
    .conv-item{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
      cursor:pointer;
      transition:all 0.2s;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    
    .conv-item:hover{
      background:#1a2332;
      border-color:#2b3644;
    }
    
    .conv-item.selected{
      background:#1a3a5f;
      border-color:#2563eb;
    }
    
    .avatar{
      width:40px;
      height:40px;
      border-radius:50%;
      background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:700;
      font-size:16px;
      flex-shrink:0;
    }
    
    .avatar img{
      width:100%;
      height:100%;
      border-radius:50%;
      object-fit:cover;
    }
    
    .conv-content{
      flex:1;
      min-width:0;
    }
    
    .conv-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:4px;
    }
    
    .conv-phone{
      font-weight:600;
      font-size:13px;
      color:var(--text);
    }
    
    .conv-status{
      font-size:10px;
      padding:2px 6px;
      border-radius:4px;
      text-transform:uppercase;
      font-weight:700;
      letter-spacing:0.3px;
    }
    
    .conv-status.bot{background:#3b82f6;color:#fff}
    .conv-status.pending{background:var(--warn);color:#111}
    .conv-status.claimed{background:var(--acc);color:#06210f}
    .conv-status.active{background:var(--acc);color:#06210f}
    .conv-status.resolved{background:var(--muted);color:#111}
    
    .conv-preview{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      margin-bottom:4px;
    }
    
    .conv-time{
      font-size:11px;
      color:var(--muted);
    }
    
    /* Numero secundario na lista de conversas */
    .conv-phone-secondary{
      font-size:11px;
      color:var(--muted);
      display:block;
      margin-top:2px;
    }
    
    /* Chat contact info */
    .chat-contact-info{
      display:flex;
      align-items:center;
      gap:8px;
    }
    
    .customer-name{
      font-weight:600;
      color:var(--acc);
      font-size:15px;
    }
    
    .phone-number{
      opacity:0.9;
      font-size:13px;
    }
    
    .btn-edit-name{
      background:transparent;
      border:1px solid var(--border);
      color:var(--muted);
      padding:4px 8px;
      border-radius:6px;
      cursor:pointer;
      font-size:12px;
      transition:all 0.2s;
    }
    
    .btn-edit-name:hover{
      background:var(--card);
      color:var(--text);
      border-color:var(--acc);
    }
    
    /* Chat area */
    .chat{
      display:grid;
      grid-template-rows:auto 1fr auto;
      height:100%;
      overflow:hidden;
    }
    
    .chat-header{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px;
      border-bottom:1px solid var(--border);
      flex-shrink:0;
    }
    
    .chat-body{
      padding:10px;
      overflow-y:auto;
      overflow-x:hidden;
      background:linear-gradient(180deg, rgba(15,23,42,.35), transparent);
      min-height:0;
    }
    
    /* Scrollbar customizado para chat */
    .chat-body::-webkit-scrollbar{
      width:8px;
    }
    
    .chat-body::-webkit-scrollbar-track{
      background:transparent;
    }
    
    .chat-body::-webkit-scrollbar-thumb{
      background:var(--border);
      border-radius:4px;
    }
    
    .chat-body::-webkit-scrollbar-thumb:hover{
      background:var(--muted);
    }
    
    /* Window closed notice */
    .window-closed-notice{
      background:linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border:2px solid #d97706;
      border-radius:12px;
      padding:16px;
      margin:10px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      animation:slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .notice-icon{
      font-size:32px;
      flex-shrink:0;
    }
    
    .notice-content{
      flex:1;
      color:#111;
    }
    
    .notice-content strong{
      display:block;
      font-size:14px;
      font-weight:700;
      margin-bottom:4px;
    }
    
    .notice-content p{
      margin:0;
      font-size:13px;
      line-height:1.5;
      opacity:0.9;
    }
    
    .bubble{
      max-width:70%;
      padding:8px 10px;
      border-radius:12px;
      margin:6px 0;
      white-space:pre-wrap
    }
    .me{background:#17365f;border:1px solid #1d4ed8;margin-left:auto}
    .other{background:#1f2937;border:1px solid #334155}
    .meta{font-size:11px;color:var(--muted);margin-top:2px}
    .chat-input{
      display:flex;
      gap:8px;
      padding:10px;
      border-top:1px solid var(--border);
      background:var(--panel);
      flex-shrink:0;
    }
    .chat-input input{
      flex:1;
      padding:10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#0b1224;
      color:var(--text)
    }
    
    .toast{
      position:fixed;
      right:16px;
      bottom:16px;
      display:flex;
      flex-direction:column;
      gap:8px;
      z-index:50
    }
    .toast .t{
      background:#0b1224;
      border:1px solid var(--border);
      padding:8px 10px;
      border-radius:10px
    }
    
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:100
    }
    .overlay.show{display:flex}
    .modal{
      background:#0b1224;
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      min-width:320px;
      max-width:400px
    }
    .grid{display:grid;gap:12px}
    .grid label{font-size:12px;color:var(--muted);font-weight:600}
    .grid input[type="text"]{
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--border);
      background:#0b1326;
      color:var(--text)
    }
    .user-info{
      background:var(--card);
      border:1px solid var(--border);
      padding:10px 12px;
      border-radius:10px;
      display:flex;
      align-items:center;
      gap:8px
    }
    .user-info .badge{
      background:var(--acc);
      color:#06210f;
      padding:4px 8px;
      border-radius:6px;
      font-size:11px;
      font-weight:700;
      text-transform:uppercase
    }
    .user-info .username{
      font-weight:600;
      color:var(--text)
    }
    
    /* Toggle Switch */
    .toggle-container{
      display:flex;
      align-items:center;
      gap:12px;
      padding:8px 0;
    }
    .toggle-label{
      flex:1;
      font-size:13px;
      color:var(--text);
      font-weight:500;
    }
    .toggle-switch{
      position:relative;
      display:inline-block;
      width:48px;
      height:24px;
    }
    .toggle-switch input{
      opacity:0;
      width:0;
      height:0;
    }
    .toggle-slider{
      position:absolute;
      cursor:pointer;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background-color:#64748b;
      transition:.3s;
      border-radius:24px;
    }
    .toggle-slider:before{
      position:absolute;
      content:"";
      height:18px;
      width:18px;
      left:3px;
      bottom:3px;
      background-color:white;
      transition:.3s;
      border-radius:50%;
    }
    input:checked + .toggle-slider{
      background-color:var(--acc);
    }
    input:checked + .toggle-slider:before{
      transform:translateX(24px);
    }
    
    .empty-state{
      padding:40px 20px;
      text-align:center;
      color:var(--muted);
      font-size:13px;
    }
    
    noscript{
      display:block; 
      padding:12px; 
      color:#fff; 
      background:#b91c1c; 
      text-align:center
    }
  </style>
</head>
<body>
  <noscript>Ative o JavaScript para usar o CRM.</noscript>

  <div class="top">
    <div class="brand">Varizemed ‚Ä¢ CRM (MVP)</div>
    <div class="spacer"></div>
    <div id="connDot" title="stream">‚óè</div>
    <button class="btn" id="btnSettings">Configurar</button>
  </div>
  
  <div class="layout">
    <!-- LEFT PANEL -->
    <div class="tabs-container">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="bot" id="tabBot">Atendente Val</button>
        <button class="tab" data-tab="pending" id="tabPending">Fila</button>
        <button class="tab" data-tab="claimed" id="tabClaimed">Atendente Humano</button>
        <button class="tab" data-tab="resolved" id="tabResolved">Resolvidos</button>
      </div>
      
      <!-- Search -->
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input id="inpSearch" placeholder="Digite o n√∫mero de telefone..." />
      </div>
      
      <!-- Conversations List -->
      <div class="card">
        <h3 id="listTitle">Atendente Val</h3>
        <div class="list" id="convList"></div>
      </div>
    </div>
    
    <!-- RIGHT CHAT -->
    <div class="card chat">
      <div class="chat-header">
        <div style="font-weight:600">Conversa:</div>
        <div class="chat-contact-info">
          <span id="chatCustomerName" class="customer-name" style="display:none"></span>
          <span id="chatConvId" class="phone-number"></span>
          <button class="btn-edit-name" id="btnEditName" title="Adicionar nome">‚ûï</button>
        </div>
        <div class="spacer"></div>
        <button class="btn btn-warn" id="btnClaim" style="display:none">Assumir</button>
        <button class="btn btn-acc" id="btnHandoff" style="display:none">ü§ñ Assumir do Bot</button>
        <button class="btn btn-danger" id="btnResolve" style="display:none">Encerrar</button>
      </div>
      <div class="chat-body" id="chatBody"></div>
      
      <!-- Aviso de janela fechada -->
      <div class="window-closed-notice" id="windowClosedNotice" style="display:none;">
        <div class="notice-icon">üîí</div>
        <div class="notice-content">
          <strong>Janela de 24h expirada</strong>
          <p>Esta conversa est√° inativa h√° mais de 24 horas. Para enviar novas mensagens, voc√™ precisa reabrir a conversa primeiro.</p>
        </div>
      </div>
      
      <div class="chat-input">
        <input id="inpMsg" placeholder="Escreva uma mensagem..." />
        <button class="btn btn-acc" id="btnSend">Enviar</button>
        <button class="btn btn-warn" id="btnReopen" style="display:none;">
          üîì Reabrir Conversa
        </button>
      </div>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <div class="overlay" id="ovl">
    <div class="modal">
      <h3 style="margin:0 0 12px 0">Configurar perfil</h3>
      
      <div class="grid">
        <label>Usu√°rio conectado</label>
        <div class="user-info">
          <span class="badge">Logado</span>
          <span class="username" id="cfgUsername">-</span>
        </div>
        
        <div class="toggle-container">
          <label class="toggle-label">Usar nome de exibi√ß√£o</label>
          <label class="toggle-switch">
            <input type="checkbox" id="cfgUsePrefixToggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
        <small style="color:var(--muted);font-size:11px;margin-top:-8px">
          Quando ativado, suas mensagens incluir√£o seu nome de exibi√ß√£o como prefixo
        </small>
        
        <div id="cfgUsePrefixContainer" style="display:none;">
          <label>Nome de Exibi√ß√£o</label>
          <input 
            type="text"
            id="cfgDisplayName" 
            placeholder="Ex: Rafael, Dr. Silva, Atendente" 
            maxlength="50"
          />
          <small style="color:var(--muted);font-size:11px;margin-top:-8px">
            Este nome aparecer√° como prefixo nas suas mensagens
          </small>
        </div>
        
        <button class="btn btn-acc" id="btnSaveCfg">Salvar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal de edi√ß√£o de nome do cliente -->
  <div class="overlay" id="ovlEditName">
    <div class="modal">
      <h3 style="margin:0 0 12px 0">Nome do Cliente</h3>
      
      <div class="grid">
        <label>Digite o nome do cliente</label>
        <input 
          type="text"
          id="inpCustomerName" 
          placeholder="Ex: Maria Silva, Jo√£o, Dr. Carlos" 
          maxlength="100"
        />
        <small style="color:var(--muted);font-size:11px;margin-top:-8px">
          Este nome ser√° exibido no lugar do n√∫mero de telefone
        </small>
        
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="btn" id="btnCancelEditName" style="flex:1">Cancelar</button>
          <button class="btn btn-acc" id="btnSaveCustomerName" style="flex:1">Salvar</button>
        </div>
      </div>
    </div>
  </div>

</body>
</html>